name: frontend cd

on: 
  workflow_run:
    workflows: ["frontend ci"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ${{ vars.RUNS_ON }}
    steps:
      - name: Connect to SSH and Run Docker Images
        env:
          PRIVATE_KEY: ${{ secrets.AWS_PRIVATE_KEY }}
          HOSTNAME: ${{ secrets.DNS_NAME }}
          USERNAME: ${{ secrets.USERNAME }}
        run: |
         ssh -o StrictHostKeyChecking=no -i private_key ${USERNAME}@${HOSTNAME} '
         docker stop frontend || true &&
         docker rm frontend || true &&
         docker pull ghcr.io/test-organization-package/frontend:latest &&
         docker run --name "frontend" -p 80:80 ghcr.io/test-organization-package/frontend:latest'
        